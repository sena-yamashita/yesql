# テスト修正計画

## 修正が必要なテスト

### 1. MySQL/MSSQLテスト
- [x] コンテキストキー名の修正（`:conn` → `:mysql`/`:mssql`）
- [x] SQLファイルを1つのSELECT文に分割
- [ ] CONVERT関数用の新しいテストケースを追加

### 2. BatchTest
- [ ] パラメータ型エラーテストのアサーション修正
- [ ] トランザクション分離レベルテストの修正

### 3. StreamTest/PostgreSQLStreamingTest
- [ ] 接続プール管理の改善
- [ ] 並行実行時の接続共有問題の解決

## 修正の詳細

### MySQL/MSSQLのSQLファイル分割
元のファイルには複数のSELECT文が含まれていたが、MySQLとMSSQLのドライバーは1つのクエリで複数のSELECT文を実行できない。

**解決策**：
1. `mysql_cast.sql` と `mssql_cast.sql` から2つ目のSELECT文を削除
2. `mysql_convert.sql` と `mssql_convert.sql` として別ファイルに分離
3. テストケースも分割して個別に実行

### BatchTestのエラー処理
`"not_a_number"` を整数型カラムに挿入しようとするテストは意図的だが、エラーハンドリングのアサーションが不適切。

**解決策**：
1. エラーの型を正確に確認
2. 部分的な結果の検証を改善

### トランザクション分離レベル
既存のトランザクション内で新しいトランザクションを開始しようとしている。

**解決策**：
1. テストの前にトランザクションをクリーンアップ
2. 分離レベル設定の実装を確認

### ストリーミングテストの接続管理
長時間実行されるストリーミングクエリで接続がタイムアウトまたは無効化される。

**解決策**：
1. 接続の有効性チェックを追加
2. 並行実行時は個別の接続を使用
3. タイムアウト設定の調整